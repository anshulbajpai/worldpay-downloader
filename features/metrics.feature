Feature: Metrics

  Background: RCS is available
    Given the RCS Initiate Payment Transmission through HodsApi is available on "/payments/worldpay/.*" returning a 200 status on success
    And the RCS Send Transaction Information through HodsApi is available on "/payments/worldpay/.*/chunks/[0-9]+" returning a 202 status on success
    And the RCS Release through HodsApi is available on "/payments/worldpay/.*/release" returning a 200 status on success
    And I have valid private and public key to the WorldPay SFTP site

  Scenario: Number of transactions by merchant code
    Given a Report "MA.PISCESSW.#M.RECON.HMRE.D110409" is available for download on WorldPay containing
    """
      |000000000100000000009210000001000000010000000000000000000000000000003334520000000000000000000000000000100000000000000000008000000000000000111050002002
      |050000000200000001550650000001000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000
      |10000000030000011010000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000200000000000000
      |1500000004465935******7108   1506000000025000101141158000E041920A                            ADE000
      |160000000580729310000000000000K1234567890K-1234560
      |1500000004465935******7108   1506000000025000101141158000E041920A                            ADE000
      |160000000580729310000000000000K1234567890K-1234560
      |10000000030000011020000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000100000000000000
      |1500000004465935******7108   1506000000025000101141158000E041920A                            ADE000
      |160000000580729310000000000000K1234567890K-1234560
      |10000000030000012010000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000200000000000000
      |1500000006465935******7108   1506000000030000101141158000E041920A                            ADE000
      |160000000780729310000000000000V1234567891014-Y5RY0
      |1500000006465935******7108   1506000000030000101141158000E041920A                            ADE000
      |160000000780729310000000000000V1234567891014-Y5RY0
      |10000000030000012020000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000100000000000000
      |1500000006465935******7108   1506000000030000101141158000E041920A                            ADE000
      |160000000780729310000000000000V1234567891014-Y5RY0
      |10000000030000013010000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000200000000000000
      |1500000006465935******7108   1506000000044440101141158000E041920A                            ADE000
      |160000000780729310000000000000A109717256408A-TTTT0
      |1500000006465935******7108   1506000000044440101141158000E041920A                            ADE000
      |160000000780729310000000000000A109717256408A-TTTT0
      |10000000030000013020000140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000100000000000000
      |1500000006465935******7108   1506000000042440101141158000E041920A                            ADE000
      |160000000780729310000000000000A106717256408A-TTTT0
      |10000000000000015010000140411000000000000000000000000000000000000000000479295360000000000000000000000000000000000000000000000000200000000000000
      |1500000000000000******0000   00000000639521101011400000000000000A                            000000
      |160000000000000000000000000000XC000843562584-8YSB0
      |1500000000000000******0000   00000000498261401011400000000000000A                            000000
      |160000000000000000000000000000XG001445528149-8YSG0
      |10000000000000015020000140411000000000000000000000000000000000000000000047353320000000000000000000000000000000000000000000000000100000000000000
      |1500000000000000******0000   00000000156198301011400000000000000A                            000000
      |160000000000000000000000000000XG001445528149-B2YZ0
      |10000000000000014010000140411000000000000000000000000000000000000000000047353320000000000000000000000000000000000000000000000000100000000000000
      |1500000000000000******0000   00000000156198301011400000000000000A                            000000
      |160000000000000000000000000000XG001445528149-B2YZ0
      |10000000000000014020000140411000000000000000000000000000000000000000000047353320000000000000000000000000000000000000000000000000100000000000000
      |1500000000000000******0000   00000000156198301011400000000000000A                            000000
      |160000000000000000000000000000XG001445528149-B2YZ0
    """
    When I trigger the download for the date "2009/04/11"
    And The metric registry contains the following counters
      | emis.transactions.SA.DEBIT.2009.04.11     | 2 |
      | emis.transactions.SA.CREDIT.2009.04.11    | 1 |
      | emis.transactions.VAT.DEBIT.2009.04.11    | 2 |
      | emis.transactions.VAT.CREDIT.2009.04.11   | 1 |
      | emis.transactions.CT.DEBIT.2009.04.11     | 2 |
      | emis.transactions.CT.CREDIT.2009.04.11    | 1 |
      | emis.transactions.EPAYE.DEBIT.2009.04.11  | 1 |
      | emis.transactions.EPAYE.CREDIT.2009.04.11 | 1 |
      | emis.transactions.OTHER.DEBIT.2009.04.11  | 2 |
      | emis.transactions.OTHER.CREDIT.2009.04.11 | 1 |

