Feature: Auditing

  Background:
    Given RCS is available
    Given a Report "MA.PISCESSW.#M.RECON.HMRE.D010114" is available for download on WorldPay containing
    """
         |000000000100000000009210000006000000010000000000000000000000000000003334520000000000000000000000000000100000000000000000008000000000000000111050002002
         |050000000200000001550650000001000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000
         |10000000030000072484393140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000
         |1500000004465935******7108   1506000000025000101141158000E041920A                            ADE000
         |160000000580729310000000000000K9988776655K-1234560
         |10000000060000072484393140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000
         |1500000007465935******7108   1506000000025000101141158000E041920A                            ADE000
         |160000000880729310000000000000K1234567890K-9999990"""
    When I trigger the download for the date "2014/01/01"

  @PAYM-191
  Scenario: EMIS report headers are stored in splunk
    Then a simple event with source 'worldpay-downloader' and type 'EmisFileHeader' has been audited with:
      | detail | line | 000000000100000000009210000006000000010000000000000000000000000000003334520000000000000000000000000000100000000000000000008000000000000000111050002002 |
    And a simple event with source 'worldpay-downloader' and type 'EmisMerchantCompanyHeader' has been audited with:
      | detail | line | 050000000200000001550650000001000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000 |
    And a simple event with source 'worldpay-downloader' and type 'EmisMerchantOutletHeader' has been audited with:
      | detail | line | 10000000030000072484393140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000 |
    And a simple event with source 'worldpay-downloader' and type 'EmisMerchantOutletHeader' has been audited with:
      | detail | line | 10000000060000072484393140411110415000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000600000000000000 |


  @PAYM-208
  Scenario: RCS calls are not audited
    Then no audit event of type 'OutboundCall' with source 'worldpay-downloader' is generated
